<%- include('layouts/header.ejs') %>
<h2 class="mb-4">Welcome....</h2>
<h2 class="mb-4">Hi.. <%= user.name %></h2>
<div class="row">

    <div class="col-md-3">
        <ul class="list-group">
            <%
            if(users.length > 0){
                for(let i=0; i<users.length;i++){
                    %>
                    <li class="list-group-item list-group-item-dark cursor-pointer user-list">
                        <img src="<%='http://localhost:3000/'+ users[i]['image'] %>
                        " alt="" height="50px" width="50px">
                        <%= users[i]['name'] %>

                        <%
                        if(users[i]['is_online'] == 1){
                            %>
                            <sup class="online-status" id="<%= users[i]['_id'] %>-status"> Online</sup>
                            <%
                        }
                        else{
                            %>
                            <sup class="offline-status" id="<%= users[i]['_id'] %>-status"> Offline</sup>
                            <%  
                        }



                        %>


                    </li>


                    <%
           
                }
            }


            %>


        </ul>

    </div>

    <div class="col-md-9">

        <h3 class="start-head"> Click to start the chat </h3>
        <div class="chat-section">
            <div id="chat-container">
                
            </div>
            <form action="" id="chat-form">
                <input type="text" name="message" placeholder="Enter the message" id="message" class="border" required>
                <input type="submit" value="Send Message" class=" btn btn-primary">


            </form>


        </div>

    </div>

</div>
<script>

   const sender_id='<%= user._id %>'
   const socket= io('/user-namespace',{
            auth:{
                token:'<%= user._id %>'
            }
   })



    $(document).ready(function(){

        $('.user-list').click(function(){
            $('.start-head').hide();
            $('.chat-section').show();

        })
    })

    socket.on('onlineuser',function(data){
        $('#'+data.userid+'-status').text('Online')
        $('#'+data.userid+'-status').removeClass('Offline-status')
        $('#'+data.userid+'-status').addClass('Online-status')

    })

    socket.on('offlineuser',function(data){
        $('#'+data.userid+'-status').text('Offline')
        $('#'+data.userid+'-status').addClass('Offline-status')
        $('#'+data.userid+'-status').removeClass('Online-status')
       
    })
</script>




<%- include('layouts/footer.ejs') %>